Bootstrap: docker
From: mambaorg/micromamba:1.4.9-bullseye-slim
Stage: condabuild

%files
varcall.yml /varcall.yml

%post
micromamba env create -f /varcall.yml
micromamba list -n varcall | grep -v "^#" | awk '{print "  - "$1"="$2}' > /opt/conda/envs/varcall/version.txt

Bootstrap: docker
From: centos:7
Stage: final

%files from condabuild
/opt/conda/envs/varcall /opt/conda/envs/varcall

%environment
export PATH=/opt/conda/envs/varcall/bin:/opt/sra-human-scrubber/scripts/:$PATH
export JAVA_HOME=/opt/conda/envs/varcall

%post
yum update -y
yum groupinstall -y @"Development Tools"
yum install -y epel-release centos-release-scl
yum update -y
yum install -y git curl wget which python27 nano htop bc tar bzip2 gzip lz4 lzma libcurl-devel libxml2-devel libgit2-devel openssl-devel harfbuzz-devel fribidi-devel libtiff-devel R-3.6.0
R -e 'install.packages("remotes", repos="https://cloud.r-project.org")'
R -e 'library(remotes); remotes::install_version("devtools", version = "2.4.3", repos="https://cloud.r-project.org")'
R -e 'library(devtools); install_version("seqinr", version = "4.2-16", repos="https://cloud.r-project.org")'
R -e 'library(devtools); install_version("stringr", version = "1.4.0", repos="https://cloud.r-project.org")'
R -e 'library(devtools); install_version("ggplot2", version = "3.4.0", repos="https://cloud.r-project.org")'
R -e 'library(devtools); install_version("reshape", version = "0.8.9", repos="https://cloud.r-project.org")'
R -e 'library(devtools); install_version("tidyr", version = "1.2.0", repos="https://cloud.r-project.org")'
R -e 'library(devtools); install_version("optparse", version = "1.7.3", repos="https://cloud.r-project.org")'
R -e 'library(devtools); install_version("reshape2", version = "1.4.4", repos="https://cloud.r-project.org")'
R -e 'library(devtools); install_version("gtable", version = "0.3.1", repos="https://cloud.r-project.org")'
R -e 'library(devtools); install_version("gridExtra", version = "2.3", repos="https://cloud.r-project.org")'
R -e 'library(devtools); install_version("dplyr", version = "1.0.10", repos="https://cloud.r-project.org")'
R -e 'library(devtools); install_version("png", version = "0.1-7", repos="https://cloud.r-project.org")'
R -e 'library(devtools); install_version("egg", version = "0.4.5", repos="https://cloud.r-project.org")'
R -e 'library(devtools); install_version("cowplot", version = "1.1.1", repos="https://cloud.r-project.org")'

export PATH=/opt/conda/envs/varcall/bin:$PATH
cd /opt/
cp /opt/conda/envs/varcall/share/picard-*/picard.jar /opt/conda/envs/varcall/bin/
cp /opt/conda/envs/varcall/share/abra2-*/abra2.jar /opt/conda/envs/varcall/bin/
git clone "https://github.com/lindenb/jvarkit.git"
cd jvarkit/
git reset --hard 3c11c6de9c11c1ebc5f8c17e19ec304f913c1bee
./gradlew -Dhttp.proxyHost=ge91097.chu-lyon.fr -Dhttp.proxyPort=8888 -Dhttps.proxyHost=ge91097.chu-lyon.fr -Dhttps.proxyPort=8888 biostar84452
cp dist/biostar84452.jar /opt/conda/envs/varcall/bin/
./gradlew -Dhttp.proxyHost=ge91097.chu-lyon.fr -Dhttp.proxyPort=8888 -Dhttps.proxyHost=ge91097.chu-lyon.fr -Dhttps.proxyPort=8888 sortsamrefname
cp dist/sortsamrefname.jar /opt/conda/envs/varcall/bin/
./gradlew -Dhttp.proxyHost=ge91097.chu-lyon.fr -Dhttp.proxyPort=8888 -Dhttps.proxyHost=ge91097.chu-lyon.fr -Dhttps.proxyPort=8888 biostar154220
cp dist/biostar154220.jar /opt/conda/envs/varcall/bin/
cd /opt/
rm -rf jvarkit

%help
    SUMMARY
    Container with tools necessary for the variant-calling nextflow pipeline seqmet.
    KNOWN BUGS
    None
    USAGE
    Called by the variant-calling nextflow pipeline seqmet.

%labels
    Version 0.1.2
    Author sib0.smb
    Date 2023-08-29
